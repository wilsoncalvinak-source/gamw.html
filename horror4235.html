<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TERMINAL 9 // CONTAINMENT_BREACH</title>
    <style>
        :root { --p-green: #00ff41; --p-red: #ff0000; --bg: #000; }
        body { background: var(--bg); color: var(--p-green); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; height: 100vh; }
        
        #game-window { max-width: 900px; margin: auto; height: 100vh; display: flex; flex-direction: column; padding: 20px; position: relative; z-index: 5; }
        #output { flex: 1; overflow-y: auto; padding: 20px 0; font-size: 1.1rem; border-bottom: 1px solid #1a1a1a; }
        .input-area { display: flex; padding: 20px 0; }
        input { background: transparent; border: none; color: var(--p-green); font-family: inherit; font-size: 1.2rem; flex: 1; outline: none; }

        /* JUMPSCARE SYSTEM */
        #jumpscare-overlay { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: #000; display: none; z-index: 100; 
            justify-content: center; align-items: center;
        }
        #jumpscare-image { width: 100%; height: 100%; object-fit: cover; }

        .proximity { color: var(--p-red); font-weight: bold; animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(0); } }
        
        .hiding { color: #555; font-style: italic; }
        canvas { position: fixed; top: 0; left: 0; opacity: 0.1; pointer-events: none; }
    </style>
</head>
<body>
    <div id="jumpscare-overlay">
        <img id="jumpscare-image" src="your_image.jpg" alt="RUN">
    </div>
    <canvas id="staticCanvas"></canvas>

    <div id="game-window">
        <div style="display:flex; justify-content:space-between; border-bottom: 1px solid #333;">
            <span id="loc">SIGNAL_SEARCHING...</span>
            <span id="san">SANITY: 100%</span>
        </div>
        <div id="output"></div>
        <div class="input-area">
            <span>>&nbsp;</span><input type="text" id="userInput" autofocus autocomplete="off">
        </div>
    </div>

<script>
const game = {
    sanity: 100,
    currentRoom: 'room_1',
    pursuerRoom: 'room_50', 
    inventory: [],
    moveCount: 0,
    isAlive: true,
    isHiding: false,

    // --- 50 ROOM DATA GENERATOR ---
    rooms: {},

    generateMap() {
        for (let i = 1; i <= 50; i++) {
            this.rooms[`room_${i}`] = {
                name: `SECTOR ${i} - ${this.getSectorName(i)}`,
                desc: this.getRoomDesc(i),
                exits: {},
                items: (i === 25) ? ['master_key'] : []
            };
        }
        // Build linear/branching connections (Non-looped)
        for (let i = 1; i < 50; i++) {
            this.rooms[`room_${i}`].exits['north'] = `room_${i+1}`;
            this.rooms[`room_${i+1}`].exits['south'] = `room_${i}`;
            // Random branches
            if (i % 5 === 0 && i < 45) {
                this.rooms[`room_${i}`].exits['east'] = `room_${i+5}`;
                this.rooms[`room_${i+5}`].exits['west'] = `room_${i}`;
            }
        }
    },

    getSectorName(i) {
        const types = ["Storage", "Habitation", "Oxygen Farm", "Med-Bay", "Reactor", "Dark Hallway", "Waste Disposal"];
        return types[i % types.length];
    },

    getRoomDesc(i) {
        const vibes = [
            "The walls are sweating a dark, viscous fluid.",
            "You hear the sound of a child laughing, then screaming.",
            "The emergency lights cast long, distorted shadows.",
            "Scratches on the floor suggest someone was dragged away.",
            "It is so quiet you can hear your own heartbeat. It's too fast."
        ];
        return vibes[i % vibes.length];
    },

    init() {
        this.generateMap();
        this.log("UPLINK ESTABLISHED. 50 SECTORS DETECTED.");
        this.log("COMMANDS: north, south, east, west, hide, take, look");
        this.updateRoom();
        this.drawStatic();
    },

    log(msg, type = "") {
        const out = document.getElementById('output');
        const p = document.createElement('p');
        p.innerHTML = msg;
        if(type) p.className = type;
        out.appendChild(p);
        out.scrollTop = out.scrollHeight;
    },

    triggerDeath() {
        if (!this.isAlive) return;
        this.isAlive = false;
        const overlay = document.getElementById('jumpscare-overlay');
        overlay.style.display = 'flex';
        
        // High-pitched glitch sound
        const audio = new AudioContext();
        const osc = audio.createOscillator();
        const gain = audio.createGain();
        osc.connect(gain); gain.connect(audio.destination);
        osc.type = 'sawtooth'; osc.frequency.setValueAtTime(800, audio.currentTime);
        osc.frequency.exponentialRampToValueAtTime(10, audio.currentTime + 1);
        osc.start(); osc.stop(audio.currentTime + 1);

        setTimeout(() => { location.reload(); }, 3000);
    },

    movePursuer() {
        if (this.isHiding) return;
        const room = this.rooms[this.pursuerRoom];
        const possibleMoves = Object.values(room.exits);
        this.pursuerRoom = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
        
        if (this.pursuerRoom === this.currentRoom) {
            this.triggerDeath();
        }
    },

    handleCommand(input) {
        if (!this.isAlive) return;
        const val = input.toLowerCase().trim();
        this.isHiding = false; // Reset hiding every turn

        if (['north', 'south', 'east', 'west'].includes(val)) {
            this.movePlayer(val);
        } else if (val === 'hide') {
            this.isHiding = true;
            this.log("You crawl into the shadows... held breath.", "hiding");
        } else if (val === 'look') {
            this.updateRoom();
        } else {
            this.log("INVALID COMMAND.");
        }

        this.moveCount++;
        if (this.moveCount % 2 === 0) this.movePursuer();
        
        // Check Proximity
        if (Object.values(this.rooms[this.currentRoom].exits).includes(this.pursuerRoom)) {
            this.log("!!! SOMETHING IS IN THE NEXT ROOM !!!", "proximity");
        }
    },

    movePlayer(dir) {
        const room = this.rooms[this.currentRoom];
        if (room.exits[dir]) {
            this.currentRoom = room.exits[dir];
            if (this.currentRoom === this.pursuerRoom) this.triggerDeath();
            else this.updateRoom();
        } else {
            this.log("DEAD END.", "proximity"); // Jumpscare on wrong way
            this.sanity -= 10;
        }
    },

    updateRoom() {
        const room = this.rooms[this.currentRoom];
        this.log(`<br><b>${room.name}</b>`);
        this.log(room.desc);
        document.getElementById('loc').innerText = room.name;
        document.getElementById('san').innerText = `SANITY: ${this.sanity}%`;
    },

    drawStatic() {
        const canvas = document.getElementById('staticCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        setInterval(() => {
            const idata = ctx.createImageData(canvas.width, canvas.height);
            for (let i = 0; i < idata.data.length; i += 4) {
                const v = Math.random() * 255;
                idata.data[i] = idata.data[i+1] = idata.data[i+2] = v;
                idata.data[i+3] = 255;
            }
            ctx.putImageData(idata, 0, 0);
        }, 50);
    }
};

document.getElementById('userInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        game.handleCommand(e.target.value);
        e.target.value = '';
    }
});

game.init();
</script>
</body>
</html>
