<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TERMINAL 9 // VOID_CRAWL</title>
    <style>
        :root { --p-green: #00ff41; --p-red: #660000; --bg: #000; }
        body { background: var(--bg); color: var(--p-green); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; height: 100vh; transition: filter 0.2s; }
        
        #game-window { max-width: 900px; margin: auto; height: 100vh; display: flex; flex-direction: column; padding: 20px; position: relative; }
        #output { flex: 1; overflow-y: auto; padding: 20px 0; font-size: 1.1rem; line-height: 1.6; }
        .input-area { display: flex; border-top: 1px solid #1a1a1a; padding: 20px 0; }
        input { background: transparent; border: none; color: var(--p-green); font-family: inherit; font-size: 1.2rem; flex: 1; outline: none; }

        /* JUMPSCARE */
        #jumpscare-overlay { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: #000; display: none; z-index: 100; 
            justify-content: center; align-items: center;
        }
        #jumpscare-img { width: 100%; height: 100%; object-fit: cover; }

        /* CORRUPTION EFFECTS */
        .corrupted { color: var(--p-red); font-weight: bold; text-shadow: 0 0 8px red; }
        #vignette { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, transparent 20%, #000 100%); pointer-events: none; z-index: 90; }
        canvas { position: fixed; top: 0; left: 0; opacity: 0.1; pointer-events: none; }
    </style>
</head>
<body>
    <div id="jumpscare-overlay"><img id="jumpscare-img" src="jumpscare.jpg"></div>
    <div id="vignette"></div>
    <canvas id="staticCanvas"></canvas>

    <div id="game-window">
        <div style="display:flex; justify-content:space-between; border-bottom: 1px solid #222;">
            <span>COORD: [<span id="coord-x">0</span>, <span id="coord-y">0</span>]</span>
            <span id="threat-level">SIGNAL: CLEAR</span>
        </div>
        <div id="output"></div>
        <div class="input-area">
            <span>>&nbsp;</span><input type="text" id="userInput" autofocus autocomplete="off">
        </div>
    </div>

<script>
const game = {
    // Player Position
    x: 0, y: 0,
    // Enemy Position
    ex: 5, ey: 5,
    isAlive: true,

    init() {
        this.log("BIO-DATA CONNECTED. EXPLORE THE FACILITY.", "meta");
        this.log("Commands: north, south, east, west, hide.");
        this.updateRoom();
        this.drawStatic();
    },

    // --- DEBILITATING SOUND ---
    playGlitchSound() {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(100, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(1, audioCtx.currentTime + 2);
        gain.gain.setValueAtTime(1, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 2);
    },

    log(msg, type = "") {
        const out = document.getElementById('output');
        const p = document.createElement('p');
        p.innerHTML = msg;
        if(type) p.className = type;
        out.appendChild(p);
        out.scrollTop = out.scrollHeight;
    },

    triggerDeath() {
        this.isAlive = false;
        document.getElementById('jumpscare-overlay').style.display = 'flex';
        this.playGlitchSound();
        setTimeout(() => {
            document.body.innerHTML = "<div style='background:black; color:red; height:100vh; display:flex; align-items:center; justify-content:center; font-family:serif;'><h1>NO SIGNAL</h1></div>";
        }, 3000);
    },

    process(input) {
        if (!this.isAlive) return;
        const cmd = input.toLowerCase().trim();
        
        // Movement Logic
        if (cmd === 'north' || cmd === 'n') this.y++;
        else if (cmd === 'south' || cmd === 's') this.y--;
        else if (cmd === 'east' || cmd === 'e') this.x++;
        else if (cmd === 'west' || cmd === 'w') this.x--;
        else if (cmd === 'hide') this.log("You compress your body into the darkness.");
        else this.log("UNKNOWN INPUT.");

        // Stalker AI: Moves one step closer to player
        if (this.ex < this.x) this.ex++;
        else if (this.ex > this.x) this.ex--;
        
        if (this.ey < this.y) this.ey++;
        else if (this.ey > this.y) this.ey--;

        this.checkState();
    },

    checkState() {
        const dist = Math.abs(this.x - this.ex) + Math.abs(this.y - this.ey);
        
        // VISUAL GLITCHING based on proximity
        if (dist <= 2) {
            document.body.style.filter = `blur(${3 - dist}px) contrast(${100 + (2/dist)*100}%)`;
            document.getElementById('threat-level').innerText = "SIGNAL: CORRUPTED";
            document.getElementById('threat-level').className = "corrupted";
        } else {
            document.body.style.filter = "none";
            document.getElementById('threat-level').innerText = "SIGNAL: STABLE";
            document.getElementById('threat-level').className = "";
        }

        if (dist === 0) {
            this.triggerDeath();
        } else {
            this.updateRoom();
        }
    },

    updateRoom() {
        document.getElementById('coord-x').innerText = this.x;
        document.getElementById('coord-y').innerText = this.y;
        
        const dist = Math.abs(this.x - this.ex) + Math.abs(this.y - this.ey);
        this.log(`<br><b>[SECTOR ${this.x}:${this.y}]</b>`);
        
        if (dist < 3) {
            this.log(this.scramble("The air is vibrating. You can hear them behind the wall."), "corrupted");
        } else {
            this.log("The silence here is unnatural. You should keep moving.");
        }
    },

    scramble(text) {
        return text.split('').map(char => Math.random() > 0.8 ? "â–ˆ" : char).join('');
    },

    drawStatic() {
        const canvas = document.getElementById('staticCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        setInterval(() => {
            const idata = ctx.createImageData(canvas.width, canvas.height);
            for (let i = 0; i < idata.data.length; i += 4) {
                idata.data[i] = idata.data[i+1] = idata.data[i+2] = Math.random() * 255;
                idata.data[i+3] = 255;
            }
            ctx.putImageData(idata, 0, 0);
        }, 150);
    }
};

document.getElementById('userInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        game.process(e.target.value);
        e.target.value = '';
    }
});

game.init();
</script>
</body>
</html>
