<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TERMINAL 9 // SIGNAL_CRITICAL</title>
    <style>
        :root { --p-green: #00ff41; --p-red: #8b0000; --bg: #000; }
        body { background: var(--bg); color: var(--p-green); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; height: 100vh; }
        
        #game-window { max-width: 900px; margin: auto; height: 100vh; display: flex; flex-direction: column; padding: 20px; position: relative; }
        #output { flex: 1; overflow-y: auto; padding: 20px 0; font-size: 1.1rem; line-height: 1.6; }
        .input-area { display: flex; border-top: 1px solid #1a1a1a; padding: 20px 0; }
        input { background: transparent; border: none; color: var(--p-green); font-family: inherit; font-size: 1.2rem; flex: 1; outline: none; }

        /* JUMPSCARE (No Flashing) */
        #jumpscare { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: #000; display: none; z-index: 100; 
            justify-content: center; align-items: center;
        }
        #jumpscare img { 
            width: 100%; height: 100%; object-fit: cover; 
            transform: scale(1.1); /* Slight zoom for intensity */
        }

        /* BLOOD AND VIGNETTE */
        #vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 40%, rgba(0, 0, 0, 0.9) 100%);
            pointer-events: none; z-index: 90;
        }

        /* DREAD UI */
        .warning { color: var(--p-red); font-weight: bold; }
        .glitch-text { color: #550000; } /* Dark, non-flashing red */
        
        /* Subtle non-strobe static */
        canvas { position: fixed; top: 0; left: 0; opacity: 0.05; pointer-events: none; }
    </style>
</head>
<body>
    <div id="jumpscare"><img src="jumpscare.jpg"></div>
    <div id="vignette"></div>
    <canvas id="staticCanvas"></canvas>

    <div id="game-window">
        <div style="display:flex; justify-content:space-between; border-bottom: 1px solid #222; padding-bottom: 5px;">
            <span>LOCATION: SECTOR <span id="loc">1</span>/50</span>
            <span id="threat-label">HEART_RATE: ELEVATED</span>
        </div>
        <div id="output"></div>
        <div class="input-area">
            <span>>&nbsp;</span><input type="text" id="userInput" autofocus autocomplete="off">
        </div>
    </div>

<script>
const game = {
    currentSector: 1,
    stalkerSector: 12,
    isAlive: true,

    // --- DEBILITATING SOUND ENGINE ---
    // Uses constant dissonance rather than quick strobing pulses
    playHorrorSound() {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const masterGain = audioCtx.createGain();
        masterGain.gain.setValueAtTime(0.8, audioCtx.currentTime);
        masterGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 3);
        masterGain.connect(audioCtx.destination);

        const frequencies = [60, 65, 900, 1200]; // Dissonant chords
        frequencies.forEach(f => {
            const osc = audioCtx.createOscillator();
            const distortion = audioCtx.createWaveShaper();
            
            // Hard distortion for a "crushing" sound
            function makeDistortionCurve(amount) {
                let k = amount, n_samples = 44100, curve = new Float32Array(n_samples);
                for (let i = 0 ; i < n_samples; ++i ) {
                    let x = i * 2 / n_samples - 1;
                    curve[i] = (3 + k) * x * 20 * (Math.PI / 180) / (Math.PI + k * Math.abs(x));
                }
                return curve;
            }
            distortion.curve = makeDistortionCurve(400);
            
            osc.type = f < 100 ? 'sawtooth' : 'square';
            osc.frequency.setValueAtTime(f, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(f * 0.5, audioCtx.currentTime + 3);
            
            osc.connect(distortion);
            distortion.connect(masterGain);
            osc.start();
            osc.stop(audioCtx.currentTime + 3);
        });
    },

    triggerJumpscare() {
        if (!this.isAlive) return;
        this.isAlive = false;
        
        const js = document.getElementById('jumpscare');
        js.style.display = 'flex';
        
        this.playHorrorSound();
        
        // Non-flashing zoom effect
        let zoom = 1.1;
        const interval = setInterval(() => {
            zoom += 0.005;
            js.querySelector('img').style.transform = `scale(${zoom})`;
            if (zoom > 1.5) clearInterval(interval);
        }, 20);

        setTimeout(() => {
            document.body.innerHTML = "<div style='color:white; background:black; height:100vh; display:flex; align-items:center; justify-content:center; font-family:serif; text-align:center;'><h1>SIGNAL LOST</h1></div>";
        }, 3000);
    },

    init() {
        this.log("BIO-MONITOR ACTIVE. PROCEED THROUGH 50 SECTORS.", "meta");
        this.log("Type 'n' for north, 's' for south, 'h' to hide.");
        this.updateRoom();
        this.drawStatic();
    },

    log(msg, type = "") {
        const out = document.getElementById('output');
        const p = document.createElement('p');
        p.innerHTML = msg;
        if(type) p.className = type;
        out.appendChild(p);
        out.scrollTop = out.scrollHeight;
    },

    process(input) {
        if (!this.isAlive) return;
        const cmd = input.toLowerCase().trim();
        
        if (cmd === 'n' || cmd === 'north') this.currentSector++;
        else if (cmd === 's' || cmd === 'south') this.currentSector = Math.max(1, this.currentSector - 1);
        else if (cmd === 'h' || cmd === 'hide') this.log("You hold your breath. The metal groans above you.");
        else this.log("COMMAND UNKNOWN.");

        // Stalker AI
        if (this.stalkerSector < this.currentSector) this.stalkerSector++;
        else if (this.stalkerSector > this.currentSector) this.stalkerSector--;

        if (this.currentSector === this.stalkerSector) {
            this.triggerJumpscare();
        } else {
            this.updateRoom();
        }
    },

    updateRoom() {
        const dist = Math.abs(this.currentSector - this.stalkerSector);
        document.getElementById('loc').innerText = this.currentSector;

        if (dist <= 1) {
            this.log("A wet, dragging sound is coming from just behind the door.", "warning");
        } else if (dist <= 3) {
            this.log("Distant scratching echoes through the pipes.");
        }

        this.log(`<br><b>[SECTOR ${this.currentSector}]</b>`);
        this.log(this.getAtmosphere(this.currentSector));

        if (this.currentSector >= 50) {
            this.log("THE AIRLOCK OPENS. ESCAPE SUCCESSFUL.");
            this.isAlive = false;
        }
    },

    getAtmosphere(n) {
        const lines = [
            "The walls are cold and damp.",
            "Emergency lighting has turned a dull, bruised purple.",
            "You find a trail of dark fluid leading deeper into the ship.",
            "Every footstep sounds twice as loud as it should.",
            "The smell of ozone and old copper is overwhelming."
        ];
        return lines[n % lines.length];
    },

    drawStatic() {
        const canvas = document.getElementById('staticCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        setInterval(() => {
            const idata = ctx.createImageData(canvas.width, canvas.height);
            for (let i = 0; i < idata.data.length; i += 4) {
                const v = Math.random() * 255;
                idata.data[i] = idata.data[i+1] = idata.data[i+2] = v;
                idata.data[i+3] = 255;
            }
            ctx.putImageData(idata, 0, 0);
        }, 100); // Slower, non-strobing static
    }
};

document.getElementById('userInput').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        game.process(e.target.value);
        e.target.value = '';
    }
});

game.init();
</script>
</body>
</html>
